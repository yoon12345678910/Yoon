<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!-- Consider adding an manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
	<!--<![endif]-->
<head>
	<meta charset="utf-8">

	<!-- Use the .htaccess and remove these lines to avoid edge case issues.
	More info: h5bp.com/b/378 -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title></title>
	<meta name="description" content="">
	<meta name="author" content="">
	
	<!-- Mobile viewport optimized: j.mp/bplateviewport -->
	<meta name="viewport" content="width=device-width,initial-scale=1">

	<!-- Place favicon.ico and apple-touch-icon.png in the root directory: mathiasbynens.be/notes/touch-icons -->
	<style>
		#wrap{
			
		}
		
		.card{
			border: 1px solid black;
			width: 70px;
			height: 100px;
			position: absolute;
			display: none;
		}
		
		.card-left{
			top: 100px;
			left: 800px;
		}
		
		.card-right{
			top: 100px;
			right: 800px;
		}
		
		#cardWrap{
			position: relative;
		}
		
	</style>
	<!-- CSS: implied media=all -->
	<!-- CSS concatenated and minified via ant build script-->
	<!-- <link rel="stylesheet" href="css/style.css"> -->
	<!-- end CSS-->

	<!-- More ideas for your <head> here: h5bp.com/d/head-Tips -->

	<!-- All JavaScript at the bottom, except for Modernizr / Respond.
	Modernizr enables HTML5 elements & feature detects; Respond is a polyfill for min/max-width CSS3 Media Queries
	For optimal performance, use a custom Modernizr build: www.modernizr.com/download/ -->
	 <script src="js/libs/modernizr-2.0.6.min.js"></script>
	<script src="http://code.jquery.com/jquery-1.7.1.js"></script>
	<!--  <script src="./jquery-ui.min.js"></script> -->
  
 
<!--  <link rel="stylesheet" href="jquery-ui.min.css">
<script src="external/jquery/jquery.js"></script> -->
<script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
</head>
<body>

	<div id="wrap">
		<div id="cardWrap">
		</div>
	</div>

</body>
<script>

var cardManager = (function(){
	
	$.shuffle = function(arr) {
        for(var j, x, i = arr.length; i; j = parseInt(Math.random() * i), x = arr[--i], arr[i] = arr[j], arr[j] = x);
        return arr;
   	};
	
	function Card(seq){
		this.seq = seq;
		this.select = true;
		this.alive = true;
	}
	
	function createCardList(MAX_SIZE){
		var cardList = [];
		for(var i = 0; i < MAX_SIZE; i++){
			var obj = new Card(i);
			cardList.push(obj); 
		}
		return cardList;
	}
	
	function getSelectableCard(){
		var found = 2;
		var tempList = [];
		for(var i = 0; i < cardList.length; i++){
			var card = cardList[i];
			if(card.select && card.alive){
				tempList.push(card);
				if(tempList.length >= 2){
					return tempList;
				}
			}
		}
		return tempList;
	}
	
	function updateSelectedCard(cardElement, callback){
		var seq = cardElement.attr('data-seq');
		var card = findCard(seq);
		card.select = false;
		card.alive = true;
		
		$(cardElement).effect('bounce', 500, function(){
			$(cardElement).effect('explode', 500, function(){
				$(cardElement).remove();
				callback();
			});
		});
		
		return seq;
	}
	
	function updateUnSelectedCard(cardElement, callback){
		if(cardElement.length == 0){
			return;	
		}
		
		var seq = cardElement.attr('data-seq');
		var card = findCard(seq);
		card.select = false;
		card.alive = false;
		
		setTimeout(function(){
			$(cardElement).effect('explode', 500, function(){
				$(cardElement).remove();
				callback();
			});	
		}, 500);
	}
	
	function findCard(seq){
		for(var i=0; i < cardList.length; i++){
			var card = cardList[i];
			if(card.seq == seq){
				return card;		
			}
		}
	}
	
	function updateCardListStatus(){
		//살아 있는 카드 다시 재조합
		var found = 0;
		$.each(cardList, function(i, v){
			if(v.select == false){
				found++;
			}				
		});
		
		if(found >= (cardList.length - 2)){
			$.each(cardList, function(i, v){
				if(v.alive == true){
					v.select = true;
				}
			});
		}
	}

	function appendCard(){
		var selectableCardList = getSelectableCard();
		$.each(selectableCardList, function(i, v){
			var cardElement = $('<div class="card">');
			var className = (i % 2 == 0)? 'card-left' : 'card-right';
			cardElement.addClass(className);
			cardElement.attr('data-seq', v.seq);
			cardElement.text(v.seq);
			$('#cardWrap').append(cardElement);
		});
	}

	function showCard(){
		$('#cardWrap').children().show();
	}
	
	function renderCard(){
		appendCard();
		showCard();
	}
	
	$('#cardWrap').on('click', '.card', function() {
		selectCount++;
		
		var self = $(this);
		var other = self.siblings().eq(0);
		
		lastSelectCardSeq = updateSelectedCard(self, showCard);
		updateUnSelectedCard(other, showCard);	
		
		if(selectCount == (cardList.length - 1)){
			console.log('마지막 선택값 :' + lastSelectCardSeq);
			return;
		}
		
		updateCardListStatus();
		
		appendCard();
		console.dir(cardList);
		// $(self).animate(option, 2000, function() {
// 			
		// });
		
	});
	
	var cardList = [];
	var lastSelectCardSeq = null;
	var selectCount = 0;
	
	return {
		init : function(maxCount){
			cardList = [];
			lastSelectCardSeq = null;
			selectCount = 0;
			
			cardList = createCardList(maxCount);
			$.shuffle(cardList);
	
			renderCard();
		},
		getLastSelectCardSeq : function(){
			return lastSelectCardSeq;
		}
	};	
	
})(); 
	


$(document).ready(function() {
	cardManager.init(9);
	console.dir(cardManager);
});

</script>
</html>
